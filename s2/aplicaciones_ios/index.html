



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Introducción a las aplicaciones iOS - TPDAM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduccion-a-las-aplicaciones-ios" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="TPDAM-iOS" class="md-header-nav__button md-logo">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              TPDAM-iOS
            </span>
            <span class="md-header-nav__topic">
              
                Introducción a las aplicaciones iOS
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="TPDAM-iOS" class="md-nav__button md-logo">
      
        <img src="../../logo.png" width="48" height="48">
      
    </a>
    TPDAM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../s1/swift_basico/" title="Introducción básica a Swift" class="md-nav__link">
      Introducción básica a Swift
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s1/ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Introducción a las aplicaciones iOS
      </label>
    
    <a href="./" title="Introducción a las aplicaciones iOS" class="md-nav__link md-nav__link--active">
      Introducción a las aplicaciones iOS
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#patron-general-para-una-aplicacion-ios-mvc" class="md-nav__link">
    Patrón general para una aplicación iOS: MVC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comenzando-nuestra-primera-aplicacion-ios" class="md-nav__link">
    Comenzando nuestra primera aplicación iOS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-del-codigo-de-una-aplicacion-estructura" class="md-nav__link">
    Estructura del código de una aplicación {#estructura}
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-plantilla-creada-por-xcode" class="md-nav__link">
    La plantilla creada por Xcode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-la-interfaz-la-vista" class="md-nav__link">
    Creación de la interfaz (la vista)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementacion-del-modelo" class="md-nav__link">
    Implementación del modelo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementacion-del-controlador" class="md-nav__link">
    Implementación del controlador
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recibir-eventos-de-la-vista" class="md-nav__link">
    Recibir eventos de la vista
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llamar-al-modelo" class="md-nav__link">
    Llamar al modelo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-la-vista" class="md-nav__link">
    Modificar la vista
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s3/intro_swift_2/" title="Más sobre Swift" class="md-nav__link">
      Más sobre Swift
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s3/concurrencia/" title="Concurrencia en iOS" class="md-nav__link">
      Concurrencia en iOS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s3/ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s4/comunicacion/" title="Comunicación entre componentes" class="md-nav__link">
      Comunicación entre componentes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s4/i18n/" title="Internacionalización de aplicaciones iOS" class="md-nav__link">
      Internacionalización de aplicaciones iOS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s4/ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s5/testing/" title="Testing básico en Xcode" class="md-nav__link">
      Testing básico en Xcode
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../miniproyecto/proyecto/" title="Miniproyecto. Juego de las siete y media" class="md-nav__link">
      Miniproyecto. Juego de las siete y media
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#patron-general-para-una-aplicacion-ios-mvc" class="md-nav__link">
    Patrón general para una aplicación iOS: MVC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comenzando-nuestra-primera-aplicacion-ios" class="md-nav__link">
    Comenzando nuestra primera aplicación iOS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-del-codigo-de-una-aplicacion-estructura" class="md-nav__link">
    Estructura del código de una aplicación {#estructura}
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-plantilla-creada-por-xcode" class="md-nav__link">
    La plantilla creada por Xcode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-la-interfaz-la-vista" class="md-nav__link">
    Creación de la interfaz (la vista)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementacion-del-modelo" class="md-nav__link">
    Implementación del modelo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementacion-del-controlador" class="md-nav__link">
    Implementación del controlador
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recibir-eventos-de-la-vista" class="md-nav__link">
    Recibir eventos de la vista
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llamar-al-modelo" class="md-nav__link">
    Llamar al modelo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-la-vista" class="md-nav__link">
    Modificar la vista
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="introduccion-a-las-aplicaciones-ios">Introducción a las aplicaciones iOS<a class="headerlink" href="#introduccion-a-las-aplicaciones-ios" title="Permanent link">&para;</a></h1>
<p>Una vez vistos los conceptos básicos del lenguaje de programación que vamos a usar, que es Swift, vamos a ver qué estructura tienen las aplicaciones en iOS. Como ahora mismo veremos, Apple utiliza mucho los patrones de diseño software en iOS. De hecho todas las <em>apps</em> de esta plataforma siguen el conocido patrón Modelo/Vista/Controlador. Por ello veremos primero en qué consiste, cómo se implementa en iOS y qué clases básicas forman la estructura de toda aplicación. Implementaremos nuestra primera aplicación iOS para poder entender mejor todos estos conceptos.</p>
<h2 id="patron-general-para-una-aplicacion-ios-mvc">Patrón general para una aplicación iOS: MVC<a class="headerlink" href="#patron-general-para-una-aplicacion-ios-mvc" title="Permanent link">&para;</a></h2>
<p>Como acabamos de comentar, las aplicaciones iOS siguen el archiconocido patrón de diseño "Modelo/Vista/Controlador", abreviado comúnmente como MVC. Aunque hay muchas variantes de este patrón y los detalles varían mucho entre ellas, en general en todas:</p>
<ul>
<li>El <strong>modelo</strong> es el "corazón" de la aplicación y la parte <em>que no se ve</em>, es decir, la estructura de clases que modelan la llamada <em>lógica de negocio</em>. Una de las ideas básicas de MVC es que el modelo debería ser independiente de la interfaz (la vista) y por tanto <strong>reutilizable</strong> aunque cambie la interfaz de la aplicación. En general, los <em>frameworks</em> de desarrollo de aplicaciones MVC  es en lo que menos suelen intervenir, e iOS no es una excepción. Es decir, el modelo estará constituido generalmente por clases propias, y no necesariamente de ninguna biblioteca del sistema.</li>
<li>La <strong>vista</strong> es la interfaz de la aplicación. Generalmente todas las plataformas de desarrollo para móviles tienen una biblioteca de componentes de interfaz de usuario: botones, campos de texto, <em>sliders</em>, ... que podemos usar para componer la vista. Como veremos, en iOS podemos crear la interfaz "arrastrando" componentes en un editor gráfico integrado en Xcode. O también podemos crear la interfaz por código.</li>
<li>El <strong>controlador</strong> es el elemento que presenta más diferencias de una variante a otra de MVC. responde a eventos (generalmente acciones del usuario - por ejemplo un <em>tap</em> sobre un botón) y realiza peticiones al modelo. Al contrario, también puede detectar un cambio en el modelo y solicitarle a la vista que lo muestre. Como veremos, en iOS el controlador es una clase que hereda de una propia del sistema.</li>
</ul>
<p>Aunque en MVC el papel de estos elementos está más o menos claro en términos generales, no suele estar tan clara la relación entre ellos (quién comunica con quién y cómo). En la variante concreta de MVC que se usa en iOS, la relación entre estos tres elementos se muestra en la siguiente figura:</p>
<p><img alt="" src="../imag/mvc.png" /></p>
<p>Como vemos, el controlador está "enmedio" de la vista y el modelo, aislando ambos entre sí, de modo que vista y modelo no tienen comunicación directa. Esto nos permite modificar uno sin afectar al otro.</p>
<p>En cuanto a la comunicación entre vista y controlador:</p>
<ul>
<li>Cuando la vista genera un evento, el controlador lo recibe a través de lo que en iOS se llama un <em>action</em>. Básicamente es un método del controlador que hace de <em>callback</em> del evento.</li>
<li>El controlador guarda referencias a los elementos de la vista que nos interesa en lo que se denominan <em>outlets</em>. Así puede cambiar la vista (por ejemplo cambiar el texto de un campo o desactivar un botón)</li>
</ul>
<p>Y entre modelo y controlador:</p>
<ul>
<li>El controlador guarda una referencia al modelo y a través de ella puede llamar a sus métodos.</li>
<li>Cuando se produce un cambio en el modelo, este "avisa" al controlador mediante métodos estándar en iOS para comunicación entre objetos, como son el KVO y las notificaciones locales.</li>
</ul>
<h2 id="comenzando-nuestra-primera-aplicacion-ios">Comenzando nuestra primera aplicación iOS<a class="headerlink" href="#comenzando-nuestra-primera-aplicacion-ios" title="Permanent link">&para;</a></h2>
<p>Vamos a implementar una aplicación muy sencilla a la que llamaremos "UAdivino". Es una versión del clásico juguete "<a href="https://es.wikipedia.org/wiki/Magic_8-Ball">la bola 8 mágica</a>", a la que se le formula una pregunta y que supuestamente responde, dando en realidad respuestas genéricas: "sí", "¡claro que no!", "es muy posible",...</p>
<p>Para crear la aplicación arrancamos Xcode:</p>
<ol>
<li>en las opciones de la izquierda seleccionamos "Create a new Xcode project". </li>
<li>En el siguiente paso elegimos la plantilla "Single View App", ya que nuestra aplicación tiene una única "pantalla". </li>
<li>Tras darle a <code>Next</code>, escribimos el nombre del proyecto, <code>UAdivino</code> </li>
<li>En la última pantalla del asistente podemos seleccionar la carpeta donde guardar el proyecto. Elegimos la que queramos.</li>
</ol>
<h2 id="estructura-del-codigo-de-una-aplicacion-estructura">Estructura del código de una aplicación {#estructura}<a class="headerlink" href="#estructura-del-codigo-de-una-aplicacion-estructura" title="Permanent link">&para;</a></h2>
<p>La siguiente figura, tomada de la "<a href="https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide">App programming guide for iOS</a>" de Apple, muestra los elementos básicos de cualquier aplicación iOS. Podemos distinguir la parte del modelo, la del controlador y la de la vista. Nótese que no hay un único controlador ni una única vista. En general, podríamos decir que por cada "pantalla" de nuestra aplicación tendremos un controlador "principal" que controla una vista. Esa vista a su vez está formada por una jerarquía de <em>subvistas</em> (paneles, botones, <em>sliders</em>,...). Esto no hay que tomarlo literalmente, ya que en una "pantalla" puede haber más de un controlador, pero es útil para hacerse una idea aproximada.</p>
<p><img alt="" src="../imag/app_structure.png" /></p>
<h2 id="la-plantilla-creada-por-xcode">La plantilla creada por Xcode<a class="headerlink" href="#la-plantilla-creada-por-xcode" title="Permanent link">&para;</a></h2>
<p>Para no tener que partir de cero, Xcode nos ha creado una plantilla con varias clases y archivos adicionales, que se corresponden con la estructura genérica de una aplicación que acabamos de ver:</p>
<p><img alt="" src="../imag/project_tree.png" /></p>
<ul>
<li>
<p>Clases:</p>
<ul>
<li><code>AppDelegate</code>: es la clase que gestiona lo que hacer ante los diferentes eventos del ciclo de vida de la aplicación: cuando acaba de arrancar, cuando va a pasar a segundo plano, ...</li>
<li><code>ViewController</code> es el controlador "inicial" de la aplicación, el que "entra en acción" cuando esta arranca. En nuestro caso además es el único controlador ya que nuestra aplicación solo tiene una pantalla.</li>
</ul>
</li>
<li>
<p>Archivos de interfaz de usuario: los <code>.storyboard</code>, que constituyen el interfaz gráfico de la aplicación</p>
<ul>
<li><code>Main.storyboard</code>: el interfaz en sí de la <em>app</em>, que luego editaremos</li>
<li><code>LaunchScreen.storyboard</code>: la pantalla que aparece mientras la aplicación se está cargando</li>
</ul>
</li>
<li>
<p>Archivos de configuración</p>
<ul>
<li><code>info.plist</code>: propiedades de configuración de la aplicación, en un formato especial denominado <em>plist</em> que ya veremos con detalle en la asignatura de persistencia de datos. Por ahora nos basta con saber que es una lista de nombres y valores de propiedades y que los valores pueden ser numéricos, cadenas o listas.</li>
</ul>
</li>
<li>
<p>Recursos: la carpeta <code>Assets.xcassets</code>, que es donde se colocan las imágenes y otros recursos de la aplicación</p>
</li>
</ul>
<h2 id="creacion-de-la-interfaz-la-vista">Creación de la interfaz (la vista)<a class="headerlink" href="#creacion-de-la-interfaz-la-vista" title="Permanent link">&para;</a></h2>
<p>La interfaz de la aplicación va a tener el siguiente aspecto, con un "cartel" explicando qué hace la <em>app</em>, un botón para solicitar la respuesta, y un campo en el que aparecerá dicha respuesta.</p>
<p><img alt="" src="../imag/UAdivino.png" /></p>
<p>Como hemos comentado, la interfaz está definida en el archivo <strong><code>Main.storyboard</code>. Ábrelo</strong> y verás que en el centro aparece una pantalla de iPhone vacía. La flecha que le apunta desde la izquierda indica que es la pantalla inicial de la <em>app</em>. En la parte superior derecha de la barra de botones de Xcode verás un botón con un cuadrado dentro de un círculo (el primer botón de esta zona). Al pulsar en él se mostrará una ventana flotante con los componentes de interfaz de usuario.</p>
<blockquote>
<p>Nota: En versiones anteriores de Xcode (&lt;=9), dicho panel era accesible en la parte inferior derecha de la ventana, sin necesidad de pulsar ningún botón.</p>
</blockquote>
<p>Primero vamos a hacer el "cartel" con el mensaje  de "Formula una pregunta en voz alta y UAdivino te dará la respuesta". En iOS este tipo de componente es un <strong><code>Label</code>. Búscalo en el panel de componentes y arrástralo a la pantalla</strong> que estamos diseñando. Una vez colocada puedes hacer las operaciones habituales: moverla con el ratón, cambiar su tamaño arrastrando los puntos de las esquinas o editar el contenido con doble clic. <strong>Cambia el texto del <code>Label</code></strong> por un mensaje como "Formula una pregunta en voz alta y UAdivino te dará la respuesta"</p>
<p>Las propiedades de cualquier componente también se pueden cambiar en el panel de la derecha estando seleccionado el componente. Este panel está dividido en varias secciones, por las que se navega con los iconos de la parte superior. La que más nos interesa por el momento es la cuarta, denominada "property inspector". <strong>Cambia el número de líneas a 2</strong> para que el texto quepa en la pantalla. Cambia también la alineación del texto a centrado para que quede mejor. </p>
<p><img alt="" src="../imag/propiedades_label.gif" /></p>
<p><strong>Arrastra los dos componentes</strong> que faltan: un botón (<code>Button</code>) y otro <code>Label</code> que debes dejar con el texto vacío y donde aparecerá el mensaje del adivino.</p>
<h2 id="implementacion-del-modelo">Implementación del modelo<a class="headerlink" href="#implementacion-del-modelo" title="Permanent link">&para;</a></h2>
<p>En esta <em>app</em> el modelo lo único que debe hacer es generar respuestas al azar a demanda. Lo podemos implementar en una clase <code>Adivino</code> que tenga un método <code>obtenerRespuesta</code></p>
<p>Para colocar el código de la clase debemos crear un archivo Swift: en Xcode, <code>File &gt; New &gt; File...</code> y en el asistente seleccionamos la plantilla "Swift File". Lo guardamos en la misma carpeta <code>UAdivino</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">import</span> <span class="nc">Foundation</span>

<span class="kd">class</span> <span class="nc">Adivino</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">obtenerRespuesta</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">respuestas</span> <span class="p">=</span> <span class="p">[</span><span class="s">&quot;Si&quot;</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="s">&quot;Ni de casualidad&quot;</span><span class="p">,</span> <span class="s">&quot;¡Por supuesto!&quot;</span><span class="p">]</span>
        <span class="kd">let</span> <span class="nv">indice</span> <span class="p">=</span> <span class="nb">Int</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="nb">UInt32</span><span class="p">(</span><span class="n">respuestas</span><span class="p">.</span><span class="bp">count</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">respuestas</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Podemos comprobar provisionalmente que el modelo funciona instanciando un <code>Adivino</code> cuando la <em>app</em> arranque y generando varias respuestas. Algo como:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">adivino</span> <span class="p">=</span> <span class="n">Adivino</span><span class="p">()</span>
<span class="k">for</span> <span class="kc">_</span> <span class="k">in</span> <span class="mf">1.</span><span class="p">.</span><span class="mi">5</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="n">obtenerRespuesta</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Podemos <strong>insertar el código anterior en la clase <code>AppDelegate</code>, dentro del primero de sus métodos</strong>: <code>application(_ application:, didFinishLaunchingWithOptions:)</code>, que es el que se ejecuta al terminar de arrancar la aplicación. </p>
<p>Para <strong>ejecutar el proyecto</strong> pulsa al botón con el símbolo de "Play" de la barra superior de Xcode, o bien selecciona la opción de menú <code>Build &gt; Run</code>. Aparecerá el simulador de iOS con la pantalla del iPhone, y en la consola de Xcode deberían aparecer los mensajes generados por el "adivino". </p>
<h2 id="implementacion-del-controlador">Implementación del controlador<a class="headerlink" href="#implementacion-del-controlador" title="Permanent link">&para;</a></h2>
<p>En el controlador es donde vamos a hacer la comunicación entre la vista y el modelo.</p>
<ul>
<li>Cada vez que se pulse el botón, el modelo debe generar una respuesta</li>
<li>Esta respuesta se debe mostrar como texto del <code>Label</code> que ahora tenemos provisionalmente vacío.</li>
</ul>
<h3 id="recibir-eventos-de-la-vista">Recibir eventos de la vista<a class="headerlink" href="#recibir-eventos-de-la-vista" title="Permanent link">&para;</a></h3>
<p>Para recibir eventos de la vista, necesitamos crear un <em>action</em>. Esto es lo que en otros entornos de programación se conoce como <em>listener</em>, <em>event handler</em>, <em>callback</em>,... Es simplemente un método del <em>controller</em> al que el sistema llama cuando se produce un determinado evento sobre un componente de la interfaz.</p>
<p>Para <strong>crear un <em>action</em> que vincule el botón y el controlador</strong> hay que seguir estos pasos en Xcode:</p>
<ol>
<li>Tener abierto el <em>storyboard</em> con la pantalla donde está el componente a vincular (en nuestro caso el botón)</li>
<li>Pasar a editar en modo <em>asistente</em>, en el que se ve tanto la interfaz como el código. En la esquina superior derecha hay dos grupos de tres botones. El primer grupo cambia el modo de edición. Nos interesa el segundo de los botones, con un icono de "aros entrelazados". Al pulsarlo, el editor se dividirá para mostrar no solo la interfaz sino también el código fuente del controller asociado.</li>
<li>En el código fuente del <code>ViewController</code> buscamos un "hueco" donde se pueda crear un método que será el llamado cuando se genere el evento.</li>
<li>Finalmente, para vincular, hacer clic con el ratón sobre el <code>Button</code> pero manteniendo pulsada también la tecla <code>Ctrl</code>. Sin soltar el ratón, "conectamos" con el código fuente del controller al punto del código del <code>ViewController</code>que hemos decidido antes.</li>
<li>Al soltar el botón del ratón nos dará a elegir el tipo de conexión (<code>Connection</code>). Seleccionamos <code>Action</code>, escribimos el nombre que tendrá el método (por ejemplo <code>botonPulsado</code>) y pulsamos el botón <code>Connect</code>.</li>
</ol>
<p>Nótese que el método que se ha creado lleva una anotación especial, <code>@IBAction</code> que indica que es un <em>action</em>. Además a la izquierda del nombre sale un círculo "relleno" que indica que está conectado a un componente de la interfaz. Si pasamos el ratón por encima aparecerá destacado el componente en fondo azul. </p>
<h3 id="llamar-al-modelo">Llamar al modelo<a class="headerlink" href="#llamar-al-modelo" title="Permanent link">&para;</a></h3>
<p>Ahora en el método del <em>action</em> <code>botonPulsado</code> tenemos que llamar al modelo. En nuestro caso es tan simple como llamar a <code>obtenerRespuesta()</code> pero para eso necesitamos declarar una instancia del modelo en el controlador. Por ello le añadimos una nueva propiedad:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//En el ViewController.swift</span>

<span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>

   <span class="kd">let</span> <span class="nv">miAdivino</span> <span class="p">=</span> <span class="n">Adivino</span><span class="p">()</span>

   <span class="p">...</span>
</pre></div>
</td></tr></table>

<p>Ahora tenemos que obtener una respuesta cuando se pulse el botón:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">@IBAction</span> <span class="kd">func</span> <span class="nf">botonPulsado</span><span class="p">(</span><span class="kc">_</span> <span class="n">sender</span><span class="p">:</span> <span class="nb">AnyObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">respuesta</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">miAdivino</span><span class="p">.</span><span class="n">obtenerRespuesta</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>pero todavía nos falta mostrarla en la interfaz. Para eso necesitamos conectar el <em>controller</em> con la vista</p>
<h3 id="modificar-la-vista">Modificar la vista<a class="headerlink" href="#modificar-la-vista" title="Permanent link">&para;</a></h3>
<p>Por cada componente de la interfaz de usuario que queramos modificar desde el <em>controller</em> necesitamos definir un <em>outlet</em>, que no es más que una variable que referencia al componente. Pero la variable no la declaramos nosotros sino que se crea de forma parecida a como se crean los <em>action</em>: gráficamente, con el ratón.</p>
<p>Queremos conectar el <em>controller</em> con el <code>Label</code> que por ahora tiene texto vacío:</p>
<ol>
<li>De nuevo ponemos el editor en modo asistente, y buscamos un "hueco" apropiado en el código fuente del <em>controller</em> donde se pueda definir la variable.</li>
<li>Arrastramos con <code>Ctrl</code> + clic desde el botón al código del <em>controller</em> pero ahora cuando soltemos el botón del ratón y nos pregunte el tipo de conexión dejamos <code>Outlet</code>. Escribimos un nombre apropiado para la variable (por ejemplo <code>labelRespuesta</code>) y pulsamos sobre <code>Connect</code>.</li>
</ol>
<p>Vemos que la variable recién creada es del tipo <code>UILabel</code> y lleva la anotación <code>@IBOutlet</code> para indicar que es un <em>outlet</em>. Si miramos la documentación de iOS veremos que a través de la propiedad <code>text</code> tenemos acceso al texto del componente. Por lo que finalmente el método del <em>action</em> que hemos hecho antes quedará:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">@IBAction</span> <span class="kd">func</span> <span class="nf">botonPulsado</span><span class="p">(</span><span class="kc">_</span> <span class="n">sender</span><span class="p">:</span> <span class="nb">AnyObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">respuesta</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">miAdivino</span><span class="p">.</span><span class="n">obtenerRespuesta</span><span class="p">()</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">labelRespuesta</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">respuesta</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ya debería funcionar todo correctamente, así que ya podemos probar la <em>app</em>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../s1/ejercicios/" title="Ejercicios" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Ejercicios
              </span>
            </div>
          </a>
        
        
          <a href="../ejercicios/" title="Ejercicios" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Ejercicios
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>