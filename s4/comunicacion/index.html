



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Comunicación entre componentes - TPDAM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#comunicacion-modelo-controlador" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="TPDAM-iOS" class="md-header-nav__button md-logo">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              TPDAM-iOS
            </span>
            <span class="md-header-nav__topic">
              
                Comunicación entre componentes
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="TPDAM-iOS" class="md-nav__button md-logo">
      
        <img src="../../logo.png" width="48" height="48">
      
    </a>
    TPDAM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../s1/swift_basico/" title="Introducción básica a Swift" class="md-nav__link">
      Introducción básica a Swift
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s1/ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s2/aplicaciones_ios/" title="Introducción a las aplicaciones iOS" class="md-nav__link">
      Introducción a las aplicaciones iOS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s2/ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s3/intro_swift_2/" title="Más sobre Swift" class="md-nav__link">
      Más sobre Swift
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s3/concurrencia/" title="Concurrencia en iOS" class="md-nav__link">
      Concurrencia en iOS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s3/ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Comunicación entre componentes
      </label>
    
    <a href="./" title="Comunicación entre componentes" class="md-nav__link md-nav__link--active">
      Comunicación entre componentes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-value-observing" class="md-nav__link">
    Key-Value Observing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notificaciones-locales" class="md-nav__link">
    Notificaciones locales
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../i18n/" title="Internacionalización de aplicaciones iOS" class="md-nav__link">
      Internacionalización de aplicaciones iOS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../s5/testing/" title="Testing básico en Xcode" class="md-nav__link">
      Testing básico en Xcode
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../miniproyecto/proyecto/" title="Miniproyecto. Juego de las siete y media" class="md-nav__link">
      Miniproyecto. Juego de las siete y media
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-value-observing" class="md-nav__link">
    Key-Value Observing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notificaciones-locales" class="md-nav__link">
    Notificaciones locales
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="comunicacion-modelo-controlador">Comunicación modelo-controlador<a class="headerlink" href="#comunicacion-modelo-controlador" title="Permanent link">&para;</a></h1>
<p>Ya hemos visto cómo se comunican bidireccionalmente el controlador y la vista:</p>
<ul>
<li>Cuando la vista genera un evento (como por ejemplo un <em>tap</em> en un botón) llama a un método del controlador (un <em>action</em>)</li>
<li>El controlador puede acceder al estado actual de ciertos elementos de la vista y manipularlo a través de los <em>outlet</em>.</li>
</ul>
<p>También hemos visto que el controlador mantiene una referencia a las clases del modelo y que así podemos llamar a la lógica de negocio, pero nos falta la otra dirección: cómo avisa el modelo al controlador de que se ha producido un evento importante. Por ejemplo supongamos una aplicación de mensajería en la que las clases del modelo reciben un nuevo mensaje, y hay que pasárselo al controlador para que éste lo muestre en la vista.</p>
<p>Una opción para comunicar eventos del modelo al controlador sería que el primero mantuviera una referencia al segundo y así pudiera llamar a cierto método o métodos. Pero esto acoplaría el código del modelo al controlador, y no nos permitiría reutilizar el modelo o partes sgnificativas de él en otras aplicaciones, o "protegerlo" de posibles cambios en el controlador.</p>
<p>Vamos a ver aquí métodos "no invasivos" para que el modelo comunique con el controlador, sin necesidad de acoplar el código de ambos. Es inevitable que controlador tenga conocimiento del modelo, pero como vamos a ver no es inevitable que el modelo tenga conocimiento del controlador.</p>
<p>En Foundation hay dos formas básicas de conseguir que dos objetos se comuniquen acoplando el código de ambos lo menos posible:</p>
<ul>
<li>
<p><strong>Key-Value observing</strong> o KVO: un objeto puede "vigilar" el cambio en el valor de las propiedades de otro. Cuando se produzca un cambio, se llamará a una función o clausura que actúa de <em>callback</em>. Podemos usar este mecanismo para hacer que el controlador observe las propiedades del modelo que nos interesa actualizar dinámicamente en la vista.</p>
</li>
<li>
<p><strong>Notificaciones:</strong> un objeto puede recibir notificaciones sobre eventos que le interesen. Asímismo otro objeto puede enviar notificaciones. El encargado de gestionar las notificaciones es un objeto intermediario denominado "centro de notificaciones". Podemos usar las notificaciones de modo que el modelo notifique que ha habido un cambio y el controlador reciba la notificación y actualice la vista. </p>
</li>
</ul>
<h2 id="key-value-observing">Key-Value Observing<a class="headerlink" href="#key-value-observing" title="Permanent link">&para;</a></h2>
<p>Gracias a Foundation, un objeto cualquiera puede <em>observar</em> cambios en las propiedades de otro. Especificamos un bloque de código (función o clausura) a ejecutar cuando se produzca este cambio. Esta funcionalidad se denomina <strong>Key-Value Observing</strong> o KVO.</p>
<p>Nótese que para que esto pueda funcionar el <em>runtime</em> tiene que "interceptar" de algún modo los cambios en las propiedades. Estas funcionalidades están integradas en el <em>runtime</em> de Objective-C, el "antiguo" lenguaje de desarrollo de Apple, y Swift todavía no las incorpora de forma totalmente nativa. Así, para que KVO funcione con nuestras clases Swift vamos a tener que usar algunas anotaciones y palabras clave especiales que referencian a Objective-C</p>
<p>Por ejemplo supongamos el siguiente código, que define una clase <code>Persona</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Persona</span>  <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">nombre</span> <span class="p">:</span> <span class="nb">String</span>
    <span class="kd">var</span> <span class="nv">edad</span> <span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">func</span> <span class="nf">cumplirAños</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">edad</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="kd">init</span><span class="p">(</span><span class="n">nombre</span><span class="p">:</span><span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">nombre</span> <span class="p">=</span> <span class="n">nombre</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">let</span> <span class="nv">pepito</span> <span class="p">=</span> <span class="n">Persona</span><span class="p">(</span><span class="n">nombre</span><span class="p">:</span><span class="s">&quot;Pepe&quot;</span><span class="p">)</span>
<span class="n">pepito</span><span class="p">.</span><span class="n">cumplirAños</span><span class="p">()</span>
<span class="bp">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">\(</span><span class="n">pepito</span><span class="p">.</span><span class="n">nombre</span><span class="si">)</span><span class="s"> tiene </span><span class="si">\(</span><span class="n">pepito</span><span class="p">.</span><span class="n">edad</span><span class="si">)</span><span class="s"> año/s&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Supongamos que nos interesa enterarnos de cuándo cambia la edad de una persona, y ejecutar cierto código en respuesta a esto. Podemos hacerlo con KVO. Lo primero es cambiar ciertos elementos de la clase para que use el <em>runtime</em> de ObjectiveC:</p>
<ul>
<li>Hacer que la clase herede de la clase base <code>NSObject</code>, que es la raíz de la jerarquía de clases de ObjectiveC</li>
<li>"Marcar" las propiedades que nos interesa observar con la anotación <code>@objc</code> y la palabra clave <code>dynamic</code> (en lugar de usar <code>@objc</code> podríamos marcar la clase entera con <code>@objcMembers</code>).</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Persona</span> <span class="p">:</span> <span class="bp">NSObject</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">nombre</span> <span class="p">:</span> <span class="nb">String</span>
    <span class="kr">@objc</span> <span class="kr">dynamic</span> <span class="kd">var</span> <span class="nv">edad</span> <span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">func</span> <span class="nf">cumplirAños</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">edad</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="kd">init</span><span class="p">(</span><span class="n">nombre</span><span class="p">:</span><span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">nombre</span> <span class="p">=</span> <span class="n">nombre</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Lo siguiente que necesitamos es poder especificar qué propiedad queremos observar. Esto se hace con una expresión denominada <em>keypath</em>. Un <em>keypath</em> es simplemente la trayectoria a seguir desde un objeto "inicial" hasta la propiedad que nos interesa. Por ejemplo algo como "persona1.nombre". O si una persona tuviera una propiedad <code>conyuge : Persona</code> podríamos ir encadenando propiedades: <code>persona1.conyuge.nombre</code>.</p>
<p>Hasta Swift 3 los <em>keypath</em> se especificaban como cadenas, pero desde Swift 4 se han añadido de forma "nativa", con una sintaxis propia que permite el chequeo de tipos por parte del compilador. Con la nueva sintaxis Los <em>keypath</em> comienzan por una barra invertida y se ponen sin comillas, ya que no son cadenas. Se especifican de forma genérica, es decir, comienzan no por un nombre de objeto concreto sino por un nombre de clase, por ejemplo <code>\Persona.nombre</code>. Si el contexto permite resolver la ambigüedad se puede omitir el nombre de la clase (pero no el <code>.</code>, por consistencia): por ejemplo <code>\.nombre</code>, <code>\.conyuge.nombre</code>.</p>
<p>Ahora ya tenemos todos los elementos para indicar que en el ejemplo anterior queremos observar los cambios en la propiedad "edad" del objeto "pepito" y en respuesta a ellos ejecutar cierto código. Para ello usamos el método <code>observe</code> sobre la instancia a observar. El primer parámetro es el <em>keypath</em> que nos interesa observar y el último una clausura con el código a ejecutar cuando cambia:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">import</span> <span class="nc">Foundation</span> 

<span class="nc">let</span> <span class="nc">observador</span> <span class="p">=</span> <span class="nc">pepito</span><span class="p">.</span><span class="nc">observe</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="nc">edad</span><span class="p">)</span> <span class="p">{</span> <span class="nc">obj</span><span class="p">,</span> <span class="nc">cambio</span> <span class="nc">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">\(</span><span class="n">obj</span><span class="p">.</span><span class="n">nombre</span><span class="si">)</span><span class="s"> ahora tiene </span><span class="si">\(</span><span class="n">obj</span><span class="p">.</span><span class="n">edad</span><span class="s">&quot;)</span>
<span class="s">} </span>
</pre></div>
</td></tr></table>

<ul>
<li>Nótese que en el <em>keypath</em> se puede omitir <code>Persona</code> al comienzo ya que claramente "edad" debe ser una propiedad de esta clase. </li>
<li>La clausura con el código a ejecutar recibe dos parámetros: <code>obj</code>, que es el objeto que estamos observando, y <code>cambio</code>, que nos da más información sobre el cambio producido (luego veremos el uso de este último)</li>
</ul>
<p>Cuando ya no nos interese seguir observando podemos parar el KVO llamando a <code>invalidate</code> sobre el valor devuelto por <code>observe</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">observador</span><span class="p">.</span><span class="n">invalidate</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Importante: las observaciones se seguirán realizando mientras el objeto  devuelto por <code>observe</code> siga definido. Cuando se "pierde" (por ejemplo era una variable local a una función y esta ya ha terminado) el KVO se para automáticamente. En versiones antiguas de iOS había que pararlo manualmente y se producía un error si se recibían nuevas observaciones cuando el observador ya no existía.</p>
</blockquote>
<p>En el ejemplo anterior solo nos interesaba el estado actual del objeto una vez producido el cambio. En algunos casos nos puede interesar más información, como saber además cuál era el valor anterior de la propiedad. Para ello se usa un parámetro de <code>observe</code> que antes hemos omitido, llamado <code>options</code>, de tipo <code>OptionSet</code>. Desde el punto de vista de su uso, un <code>OptionSet</code> es un array de constantes donde especificamos un conjunto de opciones que no son mutuamente excluyentes. En nuestro caso las opciones son constantes de la clase <a href="https://developer.apple.com/documentation/foundation/nskeyvalueobservingoptions"><code>NSKeyValueObservingOptions</code></a>. Vamos a indicar por ejemplo que nos interesa que se nos informe explícitamente del valor actual y del antiguo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">obs</span> <span class="p">=</span> <span class="n">pepito</span><span class="p">.</span><span class="n">observe</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="n">edad</span><span class="p">,</span> <span class="n">options</span><span class="p">:[.</span><span class="n">new</span><span class="p">,</span> <span class="p">.</span><span class="n">old</span><span class="p">])</span> <span class="p">{</span> <span class="n">obj</span><span class="p">,</span> <span class="n">cambio</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Antes: </span><span class="si">\(</span><span class="n">cambio</span><span class="p">.</span><span class="n">oldValue</span><span class="p">!</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Ahora: </span><span class="si">\(</span><span class="n">cambio</span><span class="p">.</span><span class="n">newValue</span><span class="p">!</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>En <code>options</code> hemos indicado qué información queremos y esta la tenemos disponible a través de propiedades del segundo parámetro de la clausura (nuestro parámetro <code>cambio</code>). Hay más opciones de KVO, por ejemplo con <code>.prior</code> indicaríamos que queremos recibir dos avisos, uno inmediatamente antes del cambio y otro inmediatamente después. Se recomienda consultar la documentación para ver más opciones.</p>
<h2 id="notificaciones-locales">Notificaciones locales<a class="headerlink" href="#notificaciones-locales" title="Permanent link">&para;</a></h2>
<p>Son algo similar a lo que en aplicaciones <em>enterprise</em> se llaman <em>colas de mensajes</em>. Implementan el patrón de diseño publicar/suscribir.</p>
<p>Cuando un objeto quiere avisar al resto del sistema, publica una notificación asignándole un nombre, y opcionalmente un <em>payload</em> (datos asociados). Los objetos que quieren recibir la notificación indican el nombre de la que le interesa, y qué método o clausura ejecutar cuando se reciba.</p>
<p>El encargado de gestionar las notificaciones es el <code>NotificationCenter</code>. Hay uno por defecto ya inicializado en cada aplicación (<code>NotificationCenter.default</code>). Se pueden crear más, pero en la mayoría de aplicaciones nos bastará con uno. A este centro de notificaciones es a quien le decimos que envíe las notificaciones (publicar) o que queremos recibir las de un determinado tipo (suscribir).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">import</span> <span class="nc">Foundation</span>

<span class="kd">class</span> <span class="nc">Emisor</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">enviar</span><span class="p">(</span><span class="n">mensaje</span><span class="p">:</span><span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//Obtenemos el centro de notificaciones por defecto</span>
        <span class="c1">//Las notificaciones tienen un nombre, un objeto que las envía (si lo ponemos a nil no queda constancia de quién) y datos adicionales, un diccionario con los datos que queramos</span>
        <span class="kd">let</span> <span class="nv">nc</span> <span class="p">=</span> <span class="n">NotificationCenter</span><span class="p">.</span><span class="k">default</span>
        <span class="n">nc</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="bp">NSNotification</span><span class="p">.</span><span class="n">Name</span><span class="p">(</span><span class="n">rawValue</span><span class="p">:</span> <span class="s">&quot;saludo&quot;</span><span class="p">),</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">userInfo</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;valor&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;mensaje&quot;</span><span class="p">:</span><span class="n">mensaje</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Receptor</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">suscribirse</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">nc</span> <span class="p">=</span> <span class="n">NotificationCenter</span><span class="p">.</span><span class="k">default</span>
        <span class="c1">//primer parámetro: añadimos como observador a nosotros (self)</span>
        <span class="c1">//selector: al recibir la notificación se llama al método recibir</span>
        <span class="c1">//name: nombre de la notificación que nos interesa</span>
        <span class="c1">//object: objeto del que nos interesa recibir notificaciones. nil == cualquiera</span>
        <span class="n">nc</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span><span class="k">#selector</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">recibir</span><span class="p">),</span> <span class="n">name</span><span class="p">:</span><span class="bp">NSNotification</span><span class="p">.</span><span class="n">Name</span><span class="p">(</span><span class="n">rawValue</span><span class="p">:</span><span class="s">&quot;saludo&quot;</span><span class="p">),</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

    <span class="p">}</span>

    <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">recibir</span><span class="p">(</span><span class="n">notificacion</span><span class="p">:</span><span class="n">Notification</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;recibido!!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">userInfo</span> <span class="p">=</span> <span class="n">notificacion</span><span class="p">.</span><span class="n">userInfo</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nv">mensaje</span> <span class="p">=</span> <span class="n">userInfo</span><span class="p">[</span><span class="s">&quot;mensaje&quot;</span><span class="p">]</span> <span class="k">as</span><span class="p">!</span> <span class="nb">String</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&quot;dice: </span><span class="si">\(</span><span class="n">mensaje</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">e</span> <span class="p">=</span> <span class="n">Emisor</span><span class="p">()</span>
<span class="kd">var</span> <span class="nv">r</span> <span class="p">=</span> <span class="n">Receptor</span><span class="p">()</span>
<span class="n">r</span><span class="p">.</span><span class="n">suscribirse</span><span class="p">()</span>
<span class="n">e</span><span class="p">.</span><span class="n">enviar</span><span class="p">(</span><span class="n">mensaje</span><span class="p">:</span><span class="s">&quot;holaaaa&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../s3/ejercicios/" title="Ejercicios" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Ejercicios
              </span>
            </div>
          </a>
        
        
          <a href="../i18n/" title="Internacionalización de aplicaciones iOS" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Internacionalización de aplicaciones iOS
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>